"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[8691],{5392(e,s,n){n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>d});let a=JSON.parse('{"id":"operator-guide/backup-restore-guide","title":"Backup and Restore Guide","description":"Comprehensive guide for backing up and restoring Walrus storage node databases with automated and manual procedures.","source":"@site/../content/operator-guide/backup-restore-guide.mdx","sourceDirName":"operator-guide","slug":"/operator-guide/backup-restore-guide","permalink":"/docs/operator-guide/backup-restore-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/operator-guide/backup-restore-guide.mdx","tags":[],"version":"current","frontMatter":{"title":"Backup and Restore Guide","description":"Comprehensive guide for backing up and restoring Walrus storage node databases with automated and manual procedures.","keywords":["walrus","backup","restore","storage node","database","recovery","checkpoint","administration","operations"]},"sidebar":"operatorSidebar","previous":{"title":"Commission and Governance","permalink":"/docs/operator-guide/commission-governance"},"next":{"title":"The Walrus Upload Relay","permalink":"/docs/operator-guide/upload-relay"}}');var t=n(2615),r=n(5756);let i={title:"Backup and Restore Guide",description:"Comprehensive guide for backing up and restoring Walrus storage node databases with automated and manual procedures.",keywords:["walrus","backup","restore","storage node","database","recovery","checkpoint","administration","operations"]},o,c={},d=[{value:"Set up automated periodic backups",id:"set-up-automated-periodic-backups",level:2},{value:"Create manual backups",id:"create-manual-backups",level:2},{value:"List available backups",id:"list-available-backups",level:2},{value:"Restore from a backup",id:"restore-from-a-backup",level:2}];function l(e){let s={a:"a",admonition:"admonition",code:"code",h2:"h2",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{TabItem:n,Tabs:a,Term:i}=s;return n||p("TabItem",!0),a||p("Tabs",!0),i||p("Term",!0),(0,t.jsxs)(t.Fragment,{children:["\n",(0,t.jsxs)(s.p,{children:["Walrus ",(0,t.jsx)(i,{lookup:"Storage node",children:"storage nodes"})," provide backup and restore functionality for the primary database containing ",(0,t.jsx)(i,{lookup:"Blob",children:"blob"})," data. This guide covers configuration requirements, operational procedures, and best practices for both automated and manual backup processes, and restore operations."]}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsx)(s.p,{children:"The current backup implementation creates full copies of the database files. This means backups require substantial disk space (approximately the same size as your active database). A checkpoint-based solution is planned for a future release."})}),"\n",(0,t.jsx)("div",{className:"outlined-tabs",children:(0,t.jsx)(a,{children:(0,t.jsx)(n,{value:"prereq",label:"Prerequisites",children:(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.input,{type:"checkbox",checked:!0,disabled:!0})," ","Storage node"," running with appropriate permissions to create backups."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.input,{type:"checkbox",checked:!0,disabled:!0})," ","Sufficient disk space for backup storage. A separate physical volume is recommended."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.input,{type:"checkbox",checked:!0,disabled:!0})," ","Unix or Linux operating system with support for Unix domain sockets."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.input,{type:"checkbox",checked:!0,disabled:!0})," ",(0,t.jsx)(s.code,{children:"walrus"})," ",(0,t.jsx)(s.a,{href:"/docs/getting-started",children:"user account"})," with appropriate permissions."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.input,{type:"checkbox",checked:!0,disabled:!0})," ","Configure the local administration socket"]}),"\n",(0,t.jsxs)(s.p,{children:["The backup system communicates with running ","storage nodes"," through a Unix domain socket. To enable this functionality:"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Configure the administration socket path in your node configuration file:"}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"    admin_socket_path: /opt/walrus/admin.socket\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"2",children:["\n",(0,t.jsxs)(s.li,{children:["Restart the ","storage node"," to initialize the socket:"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"    $ sudo systemctl restart walrus-node.service\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsx)(s.li,{children:"Verify socket creation:"}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"    $ ls -la /opt/walrus/admin.socket\n"})}),"\n",(0,t.jsxs)(s.admonition,{type:"warning",children:[(0,t.jsxs)(s.p,{children:["The ","storage node"," creates the socket with permissions ",(0,t.jsx)(s.code,{children:"srw------- 1 walrus walrus"}),", ensuring that only the ",(0,t.jsx)(s.code,{children:"walrus"}),(0,t.jsx)(i,{lookup:"User",children:"user"})," can send operations to it. This is critical for security, as operations sent to this socket are executed directly on the running ","storage node","."]}),(0,t.jsx)(s.p,{children:"Currently supported operations include:"}),(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.strong,{children:"local-admin checkpoint"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.strong,{children:"local-admin log-level"})}),"\n"]})]}),"\n"]}),"\n"]})})})}),"\n",(0,t.jsx)(s.h2,{id:"set-up-automated-periodic-backups",children:"Set up automated periodic backups"}),"\n",(0,t.jsxs)(s.p,{children:["Storage nodes"," support scheduled automatic backups through checkpoint configuration. Add the following configuration to your node configuration:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"checkpoint_config:\n  # Directory where backups are stored\n  db_checkpoint_dir: /opt/walrus/checkpoints\n\n  # Number of backups to retain (oldest are deleted)\n  max_db_checkpoints: 2\n\n  # Backup frequency (example: 4-hour interval)\n  db_checkpoint_interval:\n    secs: 14400  # 4 hours in seconds\n    nanos: 0\n\n  # Sync in-memory data to disk before creating a backup\n  sync: true\n\n  # Maximum concurrent backup operations\n  max_background_operations: 1\n\n  # Enable/disable automated backups\n  periodic_db_checkpoints: true\n"})}),"\n",(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsxs)(s.p,{children:["To disable automated backups, set ",(0,t.jsx)(s.code,{children:"periodic_db_checkpoints: false"})," in your configuration."]})}),"\n",(0,t.jsx)(s.h2,{id:"create-manual-backups",children:"Create manual backups"}),"\n",(0,t.jsxs)(s.p,{children:["Create on-demand backups using the ",(0,t.jsx)(s.code,{children:"local-admin"})," command:"]}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:["The following commands assume ",(0,t.jsx)(s.code,{children:"walrus-node"})," is in your system's PATH. If not, replace ",(0,t.jsx)(s.code,{children:"walrus-node"})," with the full path to the binary, for example ",(0,t.jsx)(s.code,{children:"/opt/walrus/bin/walrus-node"}),"."]})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"# Basic backup command\n$ sudo -u walrus walrus-node local-admin \\\n    --socket-path /opt/walrus/admin.socket \\\n    checkpoint create \\\n    --path /opt/walrus/backups/manual-backup-name\n"})}),"\n",(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsxs)(s.p,{children:["The backup operation runs in the background within the ","storage node",". After the backup creation is initialized, the process continues independently even if the command-line interface is terminated."]})}),"\n",(0,t.jsx)(s.h2,{id:"list-available-backups",children:"List available backups"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"$ sudo -u walrus walrus-node list-db-checkpoint /opt/walrus/checkpoints\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Sample output:"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"Backups:\nBackup ID: 1, Size: 85.9 GB, Files: 1055, Created: 2025-07-02T00:25:48Z\nBackup ID: 2, Size: 86.2 GB, Files: 1058, Created: 2025-07-02T04:25:52Z\n"})}),"\n",(0,t.jsx)(s.h2,{id:"restore-from-a-backup",children:"Restore from a backup"}),"\n",(0,t.jsx)(s.admonition,{type:"warning",children:(0,t.jsxs)(s.p,{children:["Do not copy backup directories directly to the ","storage node","'s data path. The restore tool must be used to properly reconstruct the database from checkpoint files. Directly copied content cannot be recognized by the storage engine."]})}),"\n",(0,t.jsx)(s.p,{children:"Follow these steps to restore from a backup:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Stop the ","storage node"," service:"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"    $ sudo systemctl stop walrus-node.service\n"})}),"\n",(0,t.jsx)(s.p,{children:"Verify the service is stopped:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"    $ sudo systemctl status walrus-node.service\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"2",children:["\n",(0,t.jsxs)(s.li,{children:["Optional: Back up the current database. Assuming the Walrus storage path is ",(0,t.jsx)(s.code,{children:"storage_path: /opt/walrus/db"}),":"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"    $ sudo -u walrus cp -r /opt/walrus/db /opt/walrus/db.backup.$(date +%Y%m%d-%H%M%S)\n"})}),"\n",(0,t.jsxs)(s.p,{children:["This command saves the main database files, events database (",(0,t.jsx)(s.code,{children:"/opt/walrus/db/events/"}),"), and event ","blob"," data (",(0,t.jsx)(s.code,{children:"/opt/walrus/db/event_blob_writer/"}),")."]}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsxs)(s.li,{children:["Clear existing data (if performing a clean restore). Remove all existing database files to ensure a clean restore. Assuming the Walrus storage path is ",(0,t.jsx)(s.code,{children:"storage_path: /opt/walrus/db"}),":"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"    $ sudo -u walrus rm -rf /opt/walrus/db/*\n"})}),"\n",(0,t.jsxs)(s.p,{children:["This command removes the main database files, events database ",(0,t.jsx)(s.code,{children:"/opt/walrus/db/events/"}),", and event ","blob"," data ",(0,t.jsx)(s.code,{children:"/opt/walrus/db/event_blob_writer/"}),"."]}),"\n",(0,t.jsxs)(s.ol,{start:"4",children:["\n",(0,t.jsx)(s.li,{children:"Restore the main database."}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{type:"warning",children:(0,t.jsxs)(s.p,{children:["The restore process can take significant time depending on database size. Run the restore command in a persistent session using ",(0,t.jsx)(s.code,{children:"tmux"})," or ",(0,t.jsx)(s.code,{children:"screen"})," to prevent interruption if your connection drops."]})}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:["If ",(0,t.jsx)(s.code,{children:"walrus-node"})," is not in your PATH, use the full path to the binary."]})}),"\n",(0,t.jsx)(s.p,{children:"Restore from a specific checkpoint:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"    $ sudo -u walrus walrus-node \\\n        restore \\\n        --db-checkpoint-path /opt/walrus/checkpoints \\\n        --db-path /opt/walrus/db \\\n        --checkpoint-id 2\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Or, restore from the latest checkpoint by omitting ",(0,t.jsx)(s.code,{children:"--checkpoint-id"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"    $ sudo -u walrus walrus-node \\\n        restore \\\n        --db-checkpoint-path /opt/walrus/checkpoints \\\n        --db-path /opt/walrus/db\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"5",children:["\n",(0,t.jsxs)(s.li,{children:["Start the ","storage node",":"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"    $ sudo systemctl start walrus-node.service\n"})}),"\n",(0,t.jsx)(s.p,{children:"Monitor startup logs:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"    $ sudo journalctl -u walrus-node.service -f\n"})}),"\n",(0,t.jsxs)(s.p,{children:["The ","storage node"," begins downloading and replaying events. This process can take some time before the node transitions to ",(0,t.jsx)(s.code,{children:"Active"})," state."]})]})}function u(e={}){let{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}function p(e,s){throw Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},5756(e,s,n){n.d(s,{R:()=>i,x:()=>o});var a=n(9471);let t={},r=a.createContext(t);function i(e){let s=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),a.createElement(r.Provider,{value:s},e.children)}}}]);