"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[2799],{5756(e,t,n){n.d(t,{R:()=>s,x:()=>i});var o=n(9471);let a={},r=o.createContext(a);function s(e){let t=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),o.createElement(r.Provider,{value:t},e.children)}},9755(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>l,frontMatter:()=>s,metadata:()=>o,toc:()=>c});let o=JSON.parse('{"id":"operator-guide/commission-governance","title":"Commission and Governance","description":"Guide to managing storage node commission collection and governance operations including authorization and contract upgrades.","source":"@site/../content/operator-guide/commission-governance.mdx","sourceDirName":"operator-guide","slug":"/operator-guide/commission-governance","permalink":"/docs/operator-guide/commission-governance","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/operator-guide/commission-governance.mdx","tags":[],"version":"current","frontMatter":{"title":"Commission and Governance","description":"Guide to managing storage node commission collection and governance operations including authorization and contract upgrades."},"sidebar":"operatorSidebar","previous":{"title":"Operating a Storage Node","permalink":"/docs/operator-guide/storage-node"},"next":{"title":"Backup and Restore Guide","permalink":"/docs/operator-guide/backup-restore-guide"}}');var a=n(2615),r=n(5756);let s={title:"Commission and Governance",description:"Guide to managing storage node commission collection and governance operations including authorization and contract upgrades."},i,d={},c=[{value:"Update the commission receiver and entity authorized for governance",id:"update-the-commission-receiver-and-entity-authorized-for-governance",level:2},{value:"Use the CLI",id:"use-the-cli",level:3},{value:"Use the web interface",id:"use-the-web-interface",level:3},{value:"Collect commission",id:"collect-commission",level:2},{value:"Use the CLI",id:"use-the-cli-1",level:3},{value:"Use the web interface",id:"use-the-web-interface-1",level:3},{value:"Manage contract upgrades",id:"manage-contract-upgrades",level:2},{value:"Compute the upgrade digest",id:"compute-the-upgrade-digest",level:3},{value:"Vote on upgrades using the web interface",id:"vote-on-upgrades-using-the-web-interface",level:3},{value:"Vote on upgrades using the CLI",id:"vote-on-upgrades-using-the-cli",level:3},{value:"Complete the upgrade",id:"complete-the-upgrade",level:3}];function h(e){let t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components},{Term:n}=t;return n||function(e,t){throw Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Term",!0),(0,a.jsxs)(a.Fragment,{children:["\n",(0,a.jsxs)(t.p,{children:["While most node parameters can be changed using ",(0,a.jsx)(t.code,{children:"StorageNodeCap"})," and are automatically updated based on the values in the node configuration, authorization for contract upgrades and withdrawing the ",(0,a.jsx)(n,{lookup:"Storage node",children:"storage node"}),"'s commission is handled separately to ensure that the hot wallet on the ","storage node"," does not need to be authorized for these operations."]}),"\n",(0,a.jsxs)(t.p,{children:["All node operators are strongly recommended to designate secure wallets for these operations that are not stored on the ","storage node"," machines."]}),"\n",(0,a.jsx)(t.p,{children:"This page explains how to update the entities that are authorized for governance (contract upgrade) and commission operations and how these operations are performed."}),"\n",(0,a.jsx)(t.h2,{id:"update-the-commission-receiver-and-entity-authorized-for-governance",children:"Update the commission receiver and entity authorized for governance"}),"\n",(0,a.jsx)(t.p,{children:"You can either designate an arbitrary object for governance and commission operations or designate an address to be authorized."}),"\n",(0,a.jsx)(t.admonition,{type:"warning",children:(0,a.jsx)(t.p,{children:"After you set the authorization, only the authorized entity can change the authorization again. Only set authorization to addresses or objects that you control and make sure they remain accessible."})}),"\n",(0,a.jsxs)(t.p,{children:["To set the authorization to receive the commission and perform governance operations, you can either use the ",(0,a.jsx)(t.code,{children:"walrus"})," binary in your CLI, or you can use the ",(0,a.jsx)(t.a,{href:"https://stake-wal.wal.app/node-operations",children:"node operations web interface"}),"."]}),"\n",(0,a.jsx)(t.h3,{id:"use-the-cli",children:"Use the CLI"}),"\n",(0,a.jsxs)(t.p,{children:["The following assumes that you have the ",(0,a.jsx)(t.code,{children:"walrus"})," binary ",(0,a.jsx)(t.a,{href:"/docs/getting-started/advanced-setup",children:"correctly set up"}),", using the wallet that is currently authorized to perform these operations. If this is the first time updating the authorized entities, this is the wallet that you used to set up the ","storage node",". To specify a wallet and config that are not in the standard locations, you can specify them using the ",(0,a.jsx)(t.code,{children:"--wallet"})," and ",(0,a.jsx)(t.code,{children:"--config"})," command line arguments."]}),"\n",(0,a.jsx)(t.p,{children:"The authorized entities for commission and governance are independent and do not need to be set to the same address or object."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"$ NODE_ID=            # Set this to your node ID.\n$ COMMISSION_AUTHORIZED_ADDRESS= # Set this to a secure wallet address that you control.\n$ GOVERNANCE_AUTHORIZED_ADDRESS= # Set this to a secure wallet address that you control.\n$ walrus node-admin set-commission-authorized --node-id $NODE_ID --address $COMMISSION_AUTHORIZED_ADDRESS\n$ walrus node-admin set-governance-authorized --node-id $NODE_ID --address $GOVERNANCE_AUTHORIZED_ADDRESS\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Instead of specifying an authorized address using the ",(0,a.jsx)(t.code,{children:"--address"})," flag, you can designate an arbitrary object as a capability using the ",(0,a.jsx)(t.code,{children:"--object"})," flag:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"$ NODE_ID=           # Set this to your node ID.\n$ COMMISSION_AUTHORIZED_OBJECT= # Set this to the ID of an object that you own in a secure wallet.\n$ GOVERNANCE_AUTHORIZED_OBJECT= # Set this to the ID of an object that you own in a secure wallet.\n$ walrus node-admin set-commission-authorized --node-id $NODE_ID --object $COMMISSION_AUTHORIZED_OBJECT\n$ walrus node-admin set-governance-authorized --node-id $NODE_ID --object $GOVERNANCE_AUTHORIZED_OBJECT\n"})}),"\n",(0,a.jsx)(t.h3,{id:"use-the-web-interface",children:"Use the web interface"}),"\n",(0,a.jsxs)(t.p,{children:["Go to the ",(0,a.jsx)(t.a,{href:"https://stake-wal.wal.app/node-operations",children:"operator panel on the staking dApp"}),", connect your wallet, and select your node either through the drop-down menu or by pasting your node ID. Then select ",(0,a.jsx)(t.strong,{children:"Set Commission Receiver"})," or ",(0,a.jsx)(t.strong,{children:"Set Governance Authorized"})," and follow the steps to send the transaction."]}),"\n",(0,a.jsx)(t.h2,{id:"collect-commission",children:"Collect commission"}),"\n",(0,a.jsx)(t.p,{children:"To collect your commission, you can either use the CLI or the web interface."}),"\n",(0,a.jsx)(t.h3,{id:"use-the-cli-1",children:"Use the CLI"}),"\n",(0,a.jsxs)(t.p,{children:["To use the CLI, make sure that ",(0,a.jsx)(t.code,{children:"walrus"})," is configured to use the authorized wallet and run the following command:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"$ NODE_ID=           # Set this to your node ID.\n$ walrus node-admin --node-id $NODE_ID collect-commission\n"})}),"\n",(0,a.jsx)(t.h3,{id:"use-the-web-interface-1",children:"Use the web interface"}),"\n",(0,a.jsxs)(t.p,{children:["To use the web interface, go to the ",(0,a.jsx)(t.a,{href:"https://stake-wal.wal.app/node-operations",children:"operator panel on the staking dApp"}),", connect your wallet and select your node either through the drop-down menu or by pasting your node ID. Then select ",(0,a.jsx)(t.strong,{children:"Collect Commission"})," and follow the steps to send the transaction."]}),"\n",(0,a.jsx)(t.h2,{id:"manage-contract-upgrades",children:"Manage contract upgrades"}),"\n",(0,a.jsx)(t.p,{children:"Contract upgrades in Walrus are managed through a quorum-based voting system. This ensures that upgrades are only applied after sufficient consensus among node operators. The process requires computing a digest of the proposed upgrade and voting on it."}),"\n",(0,a.jsxs)(t.p,{children:["When a contract upgrade is proposed, the proposer generally shares the code of the proposed upgrade with other node operators. For example, if the Walrus Foundation proposes an upgrade, it shares a specific commit hash in a branch on the ",(0,a.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus",children:"Walrus GitHub Repository"})," that contains the proposed change in either the ",(0,a.jsx)(t.code,{children:"testnet-contracts/walrus"})," or the ",(0,a.jsx)(t.code,{children:"mainnet-contracts/walrus"})," directory, depending on whether the Testnet or Mainnet contracts are being upgraded."]}),"\n",(0,a.jsx)(t.p,{children:"The vote needs to complete within 1 epoch, otherwise the committee changes and the vote needs to be repeated. To vote for an upgrade, complete the following steps."}),"\n",(0,a.jsx)(t.h3,{id:"compute-the-upgrade-digest",children:"Compute the upgrade digest"}),"\n",(0,a.jsxs)(t.p,{children:["Operators should compute the package digest of the package to upgrade. The same compiler version must be used and the correct Sui network must be specified. If you use a standard ",(0,a.jsx)(t.a,{href:"/docs/getting-started/advanced-setup#configuration",children:"Walrus configuration"}),", the Sui network is selected automatically when specifying the Walrus network using the ",(0,a.jsx)(t.code,{children:"--context"})," flag and using the up-to-date ",(0,a.jsx)(t.code,{children:"walrus"})," version ensures that the compiler version is consistent across all voters."]}),"\n",(0,a.jsxs)(t.p,{children:["To compute the digest of a proposed upgrade, use the ",(0,a.jsx)(t.code,{children:"walrus node-admin"})," command. Assuming that your current working directory is the root of the Walrus repository and you have checked out the correct commit, use the following command for Testnet upgrades:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"$ walrus node-admin package-digest --package-path testnet-contracts/walrus --context testnet\n"})}),"\n",(0,a.jsx)(t.p,{children:"And the following for Mainnet upgrades:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"$ walrus node-admin package-digest --package-path mainnet-contracts/walrus --context mainnet\n"})}),"\n",(0,a.jsx)(t.p,{children:"The command outputs a digest as hexadecimal and base64 that you can use to verify the proposal and vote on the upgrade."}),"\n",(0,a.jsx)(t.h3,{id:"vote-on-upgrades-using-the-web-interface",children:"Vote on upgrades using the web interface"}),"\n",(0,a.jsx)(t.p,{children:"Voting on an upgrade using the web interface is the easiest way and also allows you to use any wallet supported by your browser (for example, hardware wallets). To vote through the web interface:"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Go to the ",(0,a.jsx)(t.a,{href:"https://stake-wal.wal.app/node-operations",children:"operator panel on the staking dApp"}),"."]}),"\n",(0,a.jsx)(t.li,{children:"Connect your wallet and select your node."}),"\n",(0,a.jsxs)(t.li,{children:["Navigate to the ",(0,a.jsx)(t.strong,{children:"Vote on Upgrade"})," section."]}),"\n",(0,a.jsx)(t.li,{children:"Paste the Base64 package digest from the previous step."}),"\n",(0,a.jsx)(t.li,{children:"Follow the prompts to submit your vote."}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"vote-on-upgrades-using-the-cli",children:"Vote on upgrades using the CLI"}),"\n",(0,a.jsxs)(t.p,{children:["To vote on an upgrade using the CLI, ensure that your ",(0,a.jsx)(t.code,{children:"walrus"})," binary is configured with the authorized wallet, and that you are on the correct branch in the root directory of the Walrus repository."]}),"\n",(0,a.jsx)(t.p,{children:"Run the following for Testnet:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"$ NODE_ID=   # Set this to your node ID.\n$ PACKAGE_PATH=testnet-contracts/walrus\n$ UPGRADE_MANAGER_OBJECT_ID=0xc768e475fd1527b7739884d7c3a3d1bc09ae422dfdba6b9ae94c1f128297283c\n$ walrus node-admin vote-for-upgrade \\\n    --node-id $NODE_ID \\\n    --upgrade-manager-object-id $UPGRADE_MANAGER_OBJECT_ID \\\n    --package-path $PACKAGE_PATH \\\n    --context testnet\n"})}),"\n",(0,a.jsx)(t.p,{children:"Run the following for Mainnet upgrades:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"$ NODE_ID=   # Set this to your node ID.\n$ PACKAGE_PATH=mainnet-contracts/walrus\n$ UPGRADE_MANAGER_OBJECT_ID=0xc42868ad4861f22bd1bcd886ae1858d5c007458f647a49e502d44da8bbd17b51\n$ walrus node-admin vote-for-upgrade \\\n    --node-id $NODE_ID \\\n    --upgrade-manager-object-id $UPGRADE_MANAGER_OBJECT_ID \\\n    --package-path $PACKAGE_PATH \\\n    --context mainnet\n"})}),"\n",(0,a.jsx)(t.h3,{id:"complete-the-upgrade",children:"Complete the upgrade"}),"\n",(0,a.jsxs)(t.p,{children:["After a quorum of node operators has voted in favor of a proposal, the contract upgrade can be finalized. This is usually done by the proposer using a PTB that calls the respective functions to authorize, execute, and commit the upgrade. Then, depending on the upgrade, either at the start of the next epoch or immediately, the system and staking objects are migrated to the new version, by calling the ",(0,a.jsx)(t.code,{children:"migrate"})," function in the ",(0,a.jsx)(t.code,{children:"init"})," module of the ",(0,a.jsx)(t.code,{children:"walrus"})," package. The upgrade and migration can both be performed using the ",(0,a.jsx)(t.code,{children:"walrus-deploy"})," binary."]})]})}function l(e={}){let{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}}}]);