"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[2464],{4870(e,i,n){n.r(i),n.d(i,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});let s=JSON.parse('{"id":"operator-guide/signed-binaries","title":"Verifying Signed Binaries","description":"How to download and verify signed Walrus binaries and Docker images using Cosign.","source":"@site/../content/operator-guide/signed-binaries.mdx","sourceDirName":"operator-guide","slug":"/operator-guide/signed-binaries","permalink":"/docs/operator-guide/signed-binaries","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/operator-guide/signed-binaries.mdx","tags":[],"version":"current","frontMatter":{"title":"Verifying Signed Binaries","description":"How to download and verify signed Walrus binaries and Docker images using Cosign.","keywords":["walrus","signed binaries","verification","cosign","docker images","security","release"]},"sidebar":"operatorSidebar","previous":{"title":"The Walrus Upload Relay","permalink":"/docs/operator-guide/upload-relay"}}');var r=n(2615),l=n(5756);let a={title:"Verifying Signed Binaries",description:"How to download and verify signed Walrus binaries and Docker images using Cosign.",keywords:["walrus","signed binaries","verification","cosign","docker images","security","release"]},d,t={},c=[{value:"Using the verification script",id:"using-the-verification-script",level:2},{value:"Available platforms",id:"available-platforms",level:3},{value:"Available binaries",id:"available-binaries",level:3},{value:"Manual verification",id:"manual-verification",level:2},{value:"Verify using GCP KMS key directly",id:"verify-using-gcp-kms-key-directly",level:3},{value:"Docker images",id:"docker-images",level:2},{value:"Available images",id:"available-images",level:3},{value:"Image tags",id:"image-tags",level:3},{value:"Pull a signed image",id:"pull-a-signed-image",level:3},{value:"Verify a Docker image",id:"verify-a-docker-image",level:3},{value:"Verify the image digest matches",id:"verify-the-image-digest-matches",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Permission denied when verifying",id:"permission-denied-when-verifying",level:3},{value:"Signature verification failed",id:"signature-verification-failed",level:3},{value:"&quot;no matching signatures&quot; error for Docker images",id:"no-matching-signatures-error-for-docker-images",level:3},{value:"Image not found",id:"image-not-found",level:3},{value:"Security",id:"security",level:2}];function o(e){let i={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components},{TabItem:n,Tabs:s,Term:a}=i;return n||u("TabItem",!0),s||u("Tabs",!0),a||u("Term",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(i.p,{children:["Walrus release binaries and Docker images are signed using\n",(0,r.jsx)(i.a,{href:"https://github.com/sigstore/cosign",children:"Cosign"})," with a GCP KMS key. Each binary has a\ncorresponding ",(0,r.jsx)(i.code,{children:".sig"})," file containing its signature, and Docker image signatures are stored\nin the registry."]}),"\n",(0,r.jsx)("div",{className:"outlined-tabs",children:(0,r.jsx)(s,{children:(0,r.jsx)(n,{value:"prereq",label:"Prerequisites",children:(0,r.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(i.li,{className:"task-list-item",children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.input,{type:"checkbox",checked:!0,disabled:!0})," ","Install ",(0,r.jsx)(i.a,{href:"https://docs.sigstore.dev/cosign/system_config/installation/",children:"Cosign"})]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{className:"task-list-item",children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.input,{type:"checkbox",checked:!0,disabled:!0})," ","Install the ",(0,r.jsx)(i.a,{href:"https://cloud.google.com/sdk/docs/install",children:"gcloud CLI"})," (for downloading binaries)"]}),"\n"]}),"\n"]})})})}),"\n",(0,r.jsx)(i.h2,{id:"using-the-verification-script",children:"Using the verification script"}),"\n",(0,r.jsx)(i.p,{children:"The easiest way to download and verify binaries is using the provided script:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Download the script\ncurl -sSfL https://raw.githubusercontent.com/MystenLabs/walrus/main/scripts/download_and_verify_binary.sh \\\n  -o download_and_verify_binary.sh\nchmod +x download_and_verify_binary.sh\n\n# Download and verify a binary\n./download_and_verify_binary.sh <ref> <binary_name>\n"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"<ref>"})," is a git reference (branch, tag, or commit SHA)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"<binary_name>"})," is the full binary name with platform suffix"]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"For example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"./download_and_verify_binary.sh v1.0.0 walrus-ubuntu-x86_64\n"})}),"\n",(0,r.jsx)(i.p,{children:"This downloads the binary and signature, then verifies the signature using the public key."}),"\n",(0,r.jsx)(i.h3,{id:"available-platforms",children:"Available platforms"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Platform"}),(0,r.jsx)(i.th,{children:"Suffix"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Linux x86_64"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"-ubuntu-x86_64"})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Linux ARM64"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"-ubuntu-aarch64"})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"macOS x86_64"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"-macos-x86_64"})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"macOS ARM64"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"-macos-arm64"})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Windows x86_64"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"-windows-x86_64.exe"})})]})]})]}),"\n",(0,r.jsx)(i.h3,{id:"available-binaries",children:"Available binaries"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Binary"}),(0,r.jsx)(i.th,{children:"Description"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"walrus"})}),(0,r.jsxs)(i.td,{children:["The Walrus CLI ",(0,r.jsx)(a,{lookup:"Client",children:"client"})]})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"walrus-node"})}),(0,r.jsxs)(i.td,{children:["The Walrus ",(0,r.jsx)(a,{lookup:"Storage node",children:"storage node"})]})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"walrus-upload-relay"})}),(0,r.jsx)(i.td,{children:"The Walrus upload relay service"})]})]})]}),"\n",(0,r.jsx)(i.h2,{id:"manual-verification",children:"Manual verification"}),"\n",(0,r.jsx)(i.p,{children:"If you prefer to verify manually without the script, first download the signed binaries from Google Cloud Storage:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Download the binary\ngcloud storage cp gs://mysten-walrus-binaries/signed/<ref>/walrus-ubuntu-x86_64 ./walrus\n\n# Download the signature\ngcloud storage cp gs://mysten-walrus-binaries/signed/<ref>/walrus-ubuntu-x86_64.sig ./walrus.sig\n"})}),"\n",(0,r.jsx)(i.p,{children:"Then verify them using the public key:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Download the public key\ncurl -sSfL https://docs.walrus.site/walrus-signing.pub -o walrus-signing.pub\n\n# Verify the binary\ncosign verify-blob \\\n  --key walrus-signing.pub \\\n  --signature walrus.sig \\\n  --insecure-ignore-tlog \\\n  walrus\n"})}),"\n",(0,r.jsx)(i.p,{children:"If successful, you'll see:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Verified OK\n"})}),"\n",(0,r.jsx)(i.admonition,{type:"info",children:(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.code,{children:"--insecure-ignore-tlog"})," flag is required because signatures are not uploaded\nto the Sigstore transparency log. Verification is still cryptographically secure using\nthe signing key."]})}),"\n",(0,r.jsx)(i.h3,{id:"verify-using-gcp-kms-key-directly",children:"Verify using GCP KMS key directly"}),"\n",(0,r.jsx)(i.p,{children:"If you have GCP access:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Authenticate with GCP\ngcloud auth application-default login\n\n# Verify the binary\ncosign verify-blob \\\n  --key gcpkms://projects/walrus-infra/locations/global/keyRings/walrus-signing/cryptoKeys/release-sign \\\n  --signature walrus.sig \\\n  --insecure-ignore-tlog \\\n  walrus\n"})}),"\n",(0,r.jsx)(i.h2,{id:"docker-images",children:"Docker images"}),"\n",(0,r.jsxs)(i.p,{children:["Signed Docker images are published to Docker Hub with the ",(0,r.jsx)(i.code,{children:"-signed"})," suffix."]}),"\n",(0,r.jsx)(i.h3,{id:"available-images",children:"Available images"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Image"}),(0,r.jsx)(i.th,{children:"Description"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"mysten/walrus-service"})}),(0,r.jsxs)(i.td,{children:["Walrus ","storage node"," service"]})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"mysten/walrus-upload-relay"})}),(0,r.jsx)(i.td,{children:"Walrus upload relay service"})]})]})]}),"\n",(0,r.jsx)(i.h3,{id:"image-tags",children:"Image tags"}),"\n",(0,r.jsx)(i.p,{children:"Each image is tagged in two ways:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"By commit SHA:"})," ",(0,r.jsx)(i.code,{children:"mysten/walrus-service:<full-sha>-signed"})," (e.g., ",(0,r.jsx)(i.code,{children:"a5a6dc7b1234abcd-signed"}),")"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"By version:"})," ",(0,r.jsx)(i.code,{children:"mysten/walrus-service:v<version>-signed"})," (e.g., ",(0,r.jsx)(i.code,{children:"v1.0.0-signed"}),")"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"pull-a-signed-image",children:"Pull a signed image"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Pull by version\ndocker pull mysten/walrus-service:v1.0.0-signed\n\n# Pull by commit SHA\ndocker pull mysten/walrus-service:a5a6dc7b12345678-signed\n"})}),"\n",(0,r.jsx)(i.h3,{id:"verify-a-docker-image",children:"Verify a Docker image"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Download the public key\ncurl -sSfL https://docs.walrus.site/walrus-signing.pub -o walrus-signing.pub\n\n# Verify the image\ncosign verify --key walrus-signing.pub mysten/walrus-service:v1.0.0-signed\n"})}),"\n",(0,r.jsx)(i.p,{children:"Or using GCP KMS key directly:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"cosign verify \\\n  --key gcpkms://projects/walrus-infra/locations/global/keyRings/walrus-signing/cryptoKeys/release-sign \\\n  mysten/walrus-service:v1.0.0-signed\n"})}),"\n",(0,r.jsx)(i.h3,{id:"verify-the-image-digest-matches",children:"Verify the image digest matches"}),"\n",(0,r.jsx)(i.p,{children:"To ensure the image you pulled matches what was signed:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Get the digest of your local image\ndocker inspect --format='{{index .RepoDigests 0}}' mysten/walrus-service:v1.0.0-signed\n\n# Compare with the digest shown in the cosign verify output\n"})}),"\n",(0,r.jsx)(i.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(i.h3,{id:"permission-denied-when-verifying",children:"Permission denied when verifying"}),"\n",(0,r.jsx)(i.p,{children:"If you get a permission denied error when using the GCP KMS key directly:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Authenticate with GCP: ",(0,r.jsx)(i.code,{children:"gcloud auth application-default login"})]}),"\n",(0,r.jsx)(i.li,{children:"Or use the public key method instead"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"signature-verification-failed",children:"Signature verification failed"}),"\n",(0,r.jsx)(i.p,{children:"If verification fails:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Ensure you downloaded both the binary and signature for the same version"}),"\n",(0,r.jsx)(i.li,{children:"Ensure the files weren't corrupted during download"}),"\n",(0,r.jsx)(i.li,{children:"Try re-downloading both files"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"no-matching-signatures-error-for-docker-images",children:'"no matching signatures" error for Docker images'}),"\n",(0,r.jsxs)(i.p,{children:["If you see ",(0,r.jsx)(i.code,{children:"Error: no matching signatures"}),":"]}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["Ensure the image tag includes the ",(0,r.jsx)(i.code,{children:"-signed"})," suffix"]}),"\n",(0,r.jsx)(i.li,{children:"Verify the commit SHA is correct"}),"\n",(0,r.jsx)(i.li,{children:"Check that the image was actually signed"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"image-not-found",children:"Image not found"}),"\n",(0,r.jsx)(i.p,{children:"If the Docker image is not found:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Verify the commit SHA exists in the repository"}),"\n",(0,r.jsx)(i.li,{children:"Check that the signed binaries workflow ran successfully for that commit"}),"\n",(0,r.jsx)(i.li,{children:"Ensure you're using the correct image name"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"security",children:"Security"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"The signing key is stored in GCP KMS and cannot be exported"}),"\n",(0,r.jsx)(i.li,{children:"Only authorized CI/CD workflows can sign binaries and images"}),"\n",(0,r.jsx)(i.li,{children:"Each binary is signed individually, not just the archive"}),"\n",(0,r.jsx)(i.li,{children:"Docker image signatures are stored in the registry alongside the image"}),"\n"]})]})}function h(e={}){let{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}function u(e,i){throw Error("Expected "+(i?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},5756(e,i,n){n.d(i,{R:()=>a,x:()=>d});var s=n(9471);let r={},l=s.createContext(r);function a(e){let i=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function d(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(l.Provider,{value:i},e.children)}}}]);