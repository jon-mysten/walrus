"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[2717],{1406(e,t,s){s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>l});let o=JSON.parse('{"id":"system-overview/core-concepts","title":"Core Concepts","description":"Technical reference for Walrus Sui smart contracts including blob objects, storage resources, and system events for developers.","source":"@site/../content/system-overview/core-concepts.mdx","sourceDirName":"system-overview","slug":"/system-overview/core-concepts","permalink":"/docs/system-overview/core-concepts","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/system-overview/core-concepts.mdx","tags":[],"version":"current","frontMatter":{"title":"Core Concepts","description":"Technical reference for Walrus Sui smart contracts including blob objects, storage resources, and system events for developers.","keywords":["walrus","sui structures","smart contracts","blob objects","storage resources","events","system object","staking","move contracts"]},"sidebar":"docsSidebar","previous":{"title":"Advanced Setup","permalink":"/docs/getting-started/advanced-setup"},"next":{"title":"Components","permalink":"/docs/system-overview/components"}}');var n=s(2615),r=s(5756);let a={title:"Core Concepts",description:"Technical reference for Walrus Sui smart contracts including blob objects, storage resources, and system events for developers.",keywords:["walrus","sui structures","smart contracts","blob objects","storage resources","events","system object","staking","move contracts"]},i,c={},l=[{value:"Blob and storage objects",id:"blob-and-storage-objects",level:2},{value:"Events",id:"events",level:2},{value:"System and staking information",id:"system-and-staking-information",level:2}];function d(e){let t={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components},{Term:s}=t;return s||function(e,t){throw Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Term",!0),(0,n.jsxs)(n.Fragment,{children:["\n",(0,n.jsxs)(t.p,{children:["Walrus uses Sui to manage ",(0,n.jsx)(s,{lookup:"Blob metadata",children:"blob metadata"}),". Smart contract developers can read information on Sui about the ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/tree/main/contracts",children:"Walrus system"})," and stored ",(0,n.jsx)(s,{lookup:"Blob",children:"blobs"}),", or you can interact with Walrus through the ",(0,n.jsx)(s,{lookup:"Client",children:"client"})," CLI, JSON and HTTP APIs without querying or executing transactions directly on Sui."]}),"\n",(0,n.jsxs)(t.p,{children:["The following sections demonstrate how you can use Walrus objects in your own Sui smart contracts. Alternatively, you can view an ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/tree/main/examples",children:"example Sui smart contract"})," that implements a ",(0,n.jsx)(t.a,{href:"https://docs.sui.io/guides/developer/objects/object-ownership/wrapped",children:"wrapped"}),"blob","."]}),"\n",(0,n.jsxs)(t.h2,{id:"blob-and-storage-objects",children:["Blob"," and storage objects"]}),"\n",(0,n.jsxs)(t.p,{children:["Walrus ","blobs"," are represented as Sui objects of type ",(0,n.jsx)(t.code,{children:"Blob"}),". A ","blob"," is first registered, indicating that the ",(0,n.jsx)(s,{lookup:"Storage node",children:"storage nodes"})," should expect slivers from a ",(0,n.jsx)(s,{lookup:"Blob ID",children:"blob ID"})," to be stored. Then a ","blob"," is certified, indicating that a sufficient number of slivers have been stored to guarantee the ","blob","'s availability. When a ","blob"," is certified, its ",(0,n.jsx)(t.code,{children:"certified_epoch"})," field contains the epoch in which it was certified."]}),"\n",(0,n.jsxs)(t.p,{children:["A ",(0,n.jsx)(t.code,{children:"Blob"})," object is always associated with a ",(0,n.jsx)(t.code,{children:"Storage"})," object, reserving enough space for the configured time period the ","blob"," will be stored. A certified ","blob"," remains available for the duration specified by its associated storage resource."]}),"\n",(0,n.jsxs)(t.p,{children:["Concretely, ",(0,n.jsx)(t.code,{children:"Blob"})," and ",(0,n.jsx)(t.code,{children:"Storage"})," objects have the following fields, which can be queried using the ",(0,n.jsx)(t.a,{href:"https://sdk.mystenlabs.com/typescript",children:"Sui SDKs"}),":"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-move",children:"/// Reservation for storage for a given period, which is inclusive start, exclusive end.\npublic struct Storage has key, store {\n    id: UID,\n    start_epoch: u32,\n    end_epoch: u32,\n    storage_size: u64,\n}\n\n/// The blob structure represents a blob that has been registered to with some storage,\n/// and then may eventually be certified as being available in the system.\npublic struct Blob has key, store {\n    id: UID,\n    registered_epoch: u32,\n    blob_id: u256,\n    size: u64,\n    encoding_type: u8,\n    // Stores the epoch first certified if any.\n    certified_epoch: option::Option<u32>,\n    storage: Storage,\n    // Marks if this blob can be deleted.\n    deletable: bool,\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Public functions associated with these objects can be found in the respective ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/tree/main/contracts/walrus/sources/system/storage_resource.move",children:(0,n.jsx)(t.code,{children:"storage_resource"})})," and ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/tree/main/contracts/walrus/sources/system/blob.move",children:(0,n.jsx)(t.code,{children:"blob"})})," Move modules. Storage resources can be split and merged in time and data capacity, and can be transferred between users allowing complex contracts to be created."]}),"\n",(0,n.jsx)(t.h2,{id:"events",children:"Events"}),"\n",(0,n.jsxs)(t.p,{children:["Walrus uses ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/blob/main/contracts/walrus/sources/system/events.move",children:"custom Sui events"})," to notify ","storage nodes"," of updates concerning stored ","blobs"," and the state of the network. Applications can also use ",(0,n.jsx)(t.a,{href:"https://docs.sui.io/references/sui-api",children:"Sui RPC facilities"})," to observe Walrus related events."]}),"\n",(0,n.jsxs)(t.p,{children:["When a ","blob"," is first registered, a ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/blob/main/contracts/walrus/sources/system/events.move#L12-L23",children:(0,n.jsx)(t.code,{children:"BlobRegistered"})})," event is emitted that informs ","storage nodes"," that they should expect slivers associated with its ","Blob ID",". Eventually when the ","blob"," is certified, a ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/blob/main/contracts/walrus/sources/system/events.move#L25-L35",children:(0,n.jsx)(t.code,{children:"BlobCertified"})})," is emitted containing information about the ","blob ID"," and the epoch after which the ","blob"," is deleted. Before that epoch the ","blob"," is guaranteed to be available."]}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/blob/main/contracts/walrus/sources/system/events.move#L25-L35",children:(0,n.jsx)(t.code,{children:"BlobCertified"})})," event with ",(0,n.jsx)(t.code,{children:"deletable"})," set to false and an ",(0,n.jsx)(t.code,{children:"end_epoch"})," in the future indicates that the ","blob"," is available until this epoch. A light ","client"," proof that this event was emitted for a ","blob ID"," constitutes a proof of availability for the data with this ","blob ID",". When a ",(0,n.jsx)(s,{lookup:"Deletable blob",children:"deletable blob"})," is deleted, a ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/blob/main/contracts/walrus/sources/system/events.move#L37-L46",children:(0,n.jsx)(t.code,{children:"BlobDeleted"})})," event is emitted."]}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/blob/main/contracts/walrus/sources/system/events.move#L48-L52",children:(0,n.jsx)(t.code,{children:"InvalidBlobID"})})," event is emitted when ","storage nodes"," detect an incorrectly encoded ","blob",". Anyone attempting a read on such a ","blob"," is guaranteed to also detect it as invalid."]}),"\n",(0,n.jsxs)(t.p,{children:["System level events such as ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/blob/main/contracts/walrus/sources/system/events.move#L54-L57",children:(0,n.jsx)(t.code,{children:"EpochChangeStart"})})," and ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/blob/main/contracts/walrus/sources/system/events.move#L59-L63",children:(0,n.jsx)(t.code,{children:"EpochChangeDone"})})," indicate transitions between epochs. And associated events such as ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/blob/main/contracts/walrus/sources/system/events.move#L65-L69",children:(0,n.jsx)(t.code,{children:"ShardsReceived"})}),", ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/blob/main/contracts/walrus/sources/system/events.move#L71-L74",children:(0,n.jsx)(t.code,{children:"EpochParametersSelected"})}),", and ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/blob/main/contracts/walrus/sources/system/events.move#L76-L80",children:(0,n.jsx)(t.code,{children:"ShardRecoveryStart"})})," indicate ","storage node"," level events related to epoch transitions, ",(0,n.jsx)(s,{lookup:"Shard",children:"shard"})," migrations, and epoch parameters."]}),"\n",(0,n.jsx)(t.h2,{id:"system-and-staking-information",children:"System and staking information"}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/blob/main/contracts/walrus/sources/system/system_state_inner.move",children:"Walrus system object"})," contains metadata about the available and used storage and the price of storage per KiB of storage in ",(0,n.jsx)(t.a,{href:"/docs/walrus-client/storing-blobs",children:"FROST"}),". The committee structure within the system object can be used to read the current epoch number and information about the committee. Committee changes between epochs are managed by a set of ",(0,n.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/tree/main/contracts/walrus/sources/staking",children:"staking contracts"})," that implement a full delegated proof of stake system based on the ",(0,n.jsx)(s,{lookup:"WAL",children:"WAL"})," token."]})]})}function h(e={}){let{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},5756(e,t,s){s.d(t,{R:()=>a,x:()=>i});var o=s(9471);let n={},r=o.createContext(n);function a(e){let t=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),o.createElement(r.Provider,{value:t},e.children)}}}]);