"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[1826],{5756(e,s,i){i.d(s,{R:()=>r,x:()=>l});var n=i(9471);let t={},o=n.createContext(t);function r(e){let s=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),n.createElement(o.Provider,{value:s},e.children)}},7924(e,s,i){i.r(s),i.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>d});let n=JSON.parse('{"id":"sites/ci-cd/github-actions-workflow","title":"Writing Your Workflow","description":"Guide to creating GitHub Actions workflows for automated Walrus Sites deployment using the official GitHub Action.","source":"@site/../content/sites/ci-cd/github-actions-workflow.mdx","sourceDirName":"sites/ci-cd","slug":"/sites/ci-cd/github-actions-workflow","permalink":"/docs/sites/ci-cd/github-actions-workflow","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/sites/ci-cd/github-actions-workflow.mdx","tags":[],"version":"current","frontMatter":{"title":"Writing Your Workflow","description":"Guide to creating GitHub Actions workflows for automated Walrus Sites deployment using the official GitHub Action.","keywords":["walrus sites","github actions","workflow","deployment","automation","ci/cd","static files","build process"]},"sidebar":"sitesSidebar","previous":{"title":"Preparing Your Deployment Credentials","permalink":"/docs/sites/ci-cd/preparing-deployment-credentials"},"next":{"title":"Site Data Authentication","permalink":"/docs/sites/security/site-data-authentication"}}');var t=i(2615),o=i(5756);let r={title:"Writing Your Workflow",description:"Guide to creating GitHub Actions workflows for automated Walrus Sites deployment using the official GitHub Action.",keywords:["walrus sites","github actions","workflow","deployment","automation","ci/cd","static files","build process"]},l,c={},d=[{value:"Using the Walrus Site GitHub Action",id:"using-the-walrus-site-github-action",level:2},{value:"About <code>GITHUB_TOKEN</code>",id:"about-github_token",level:3},{value:"New site vs existing site",id:"new-site-vs-existing-site",level:3},{value:"Creating your workflow",id:"creating-your-workflow",level:2},{value:"Example workflows",id:"example-workflows",level:2}];function a(e){let s={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components},{TabItem:i,Tabs:n}=s;return i||u("TabItem",!0),n||u("Tabs",!0),(0,t.jsxs)(t.Fragment,{children:["\n",(0,t.jsx)(s.p,{children:"You can create GitHub workflows to automate your Walrus Site deployments using the official Walrus Site GitHub Action."}),"\n",(0,t.jsx)("div",{className:"outlined-tabs",children:(0,t.jsx)(n,{children:(0,t.jsxs)(i,{value:"prereq",label:"Prerequisites",children:[(0,t.jsx)(s.p,{children:"The Walrus Site action operates on an already built site directory. The action does not build your site, it only deploys existing static files to Walrus."}),(0,t.jsx)(s.p,{children:"This means:"}),(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"If your site consists of ready-to-deploy static files (HTML, CSS, JS), you can use the action directly."}),"\n",(0,t.jsxs)(s.li,{children:["If your site requires a build step (React, Vue, Svelte, and so on), you ",(0,t.jsx)(s.strong,{children:"must"})," include build steps in your workflow before calling the deploy action."]}),"\n"]})]})})}),"\n",(0,t.jsx)(s.h2,{id:"using-the-walrus-site-github-action",children:"Using the Walrus Site GitHub Action"}),"\n",(0,t.jsxs)(s.p,{children:["The action (",(0,t.jsx)(s.code,{children:"MystenLabs/walrus-sites/.github/actions/deploy"}),") requires these inputs:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"SUI_ADDRESS"})}),": Your Sui address (GitHub variable)"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"SUI_KEYSTORE"})}),": Your private key in base64 format (GitHub secret)"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"DIST"})}),": Path to your ",(0,t.jsx)(s.strong,{children:"built"})," site directory"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Optional inputs include:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"SUI_NETWORK"})}),": Target network (",(0,t.jsx)(s.code,{children:"mainnet"})," or ",(0,t.jsx)(s.code,{children:"testnet"}),", defaults to ",(0,t.jsx)(s.code,{children:"mainnet"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"EPOCHS"})}),": Number of epochs to keep the site stored (defaults to ",(0,t.jsx)(s.code,{children:"5"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"WALRUS_CONFIG"})}),": Custom Walrus configuration (downloads default if not provided)"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"SITES_CONFIG"})}),": Custom sites configuration (downloads default if not provided)"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"WS_RESOURCES"})}),": Full path to the ",(0,t.jsx)(s.code,{children:"ws-resources.json"})," file (defaults to ",(0,t.jsx)(s.code,{children:"DIST/ws-resources.json"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"GITHUB_TOKEN"})}),": Enables automatic pull request creation when site resources change"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.h3,{id:"about-github_token",children:["About ",(0,t.jsx)(s.code,{children:"GITHUB_TOKEN"})]}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"GITHUB_TOKEN"})," input is particularly useful for tracking changes to your site's resources. When you deploy a site, ",(0,t.jsx)(s.code,{children:"site-builder"})," creates or updates a ",(0,t.jsx)(s.code,{children:"ws-resources.json"})," file that tracks the site's data. If this file changes during deployment, the action can automatically create a pull request with the updated file."]}),"\n",(0,t.jsx)(s.p,{children:"To use this feature:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Set ",(0,t.jsx)(s.code,{children:"GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}"})," in your workflow."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Add these ",(0,t.jsx)(s.a,{href:"https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/controlling-permissions-for-github_token",children:"permissions"})," to your workflow:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"permissions:\ncontents: write\npull-requests: write\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:["If you don't provide the ",(0,t.jsx)(s.code,{children:"GITHUB_TOKEN"}),", the action still deploys your site successfully but doesn't create pull requests for resource file changes."]})}),"\n",(0,t.jsx)(s.h3,{id:"new-site-vs-existing-site",children:"New site vs existing site"}),"\n",(0,t.jsx)(s.p,{children:"Understanding how the workflow behaves depends on whether you have an existing site:"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsxs)(s.strong,{children:["New site (no existing ",(0,t.jsx)(s.code,{children:"object_id"}),"):"]})}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Creates a new Walrus Site on Sui."}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Generates a ",(0,t.jsx)(s.code,{children:"ws-resources.json"})," file in your ",(0,t.jsx)(s.code,{children:"DIST"})," directory (or updates the file specified by ",(0,t.jsx)(s.code,{children:"WS_RESOURCES"}),")."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["This file contains the ",(0,t.jsx)(s.code,{children:"object_id"})," of your newly created site."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["If ",(0,t.jsx)(s.code,{children:"GITHUB_TOKEN"})," is provided with correct permissions, creates a pull request with these changes."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsxs)(s.strong,{children:["Existing site (has ",(0,t.jsx)(s.code,{children:"object_id"}),"):"]})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Uses the existing ",(0,t.jsx)(s.code,{children:"object_id"})," from your Walrus-Sites resources file to update the same site."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Only creates PRs if the resources file changes during deployment."}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["This applies whether you've previously deployed using GitHub Actions or manually using the CLI, as long as the ",(0,t.jsx)(s.code,{children:"object_id"})," is present in your ",(0,t.jsx)(s.code,{children:"WS_RESOURCES"})," file (defaults to ",(0,t.jsx)(s.code,{children:"DIST/ws-resources.json"}),")."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"ws-resources.json"})," file is crucial because it tells the action which site to update. Make sure to merge the PR from the first run so future deployments update the same site instead of creating new ones."]}),"\n",(0,t.jsxs)(s.p,{children:["Once your site is deployed and you have the ",(0,t.jsx)(s.code,{children:"object_id"}),", you can link it with a SuiNS name to make your site accessible at ",(0,t.jsx)(s.code,{children:"<suins>.wal.app"}),". See ",(0,t.jsx)(s.a,{href:"/docs/sites/custom-domains/setting-a-suins-name",children:"Set a SuiNS name"})," for details on how to set this up."]}),"\n",(0,t.jsx)(s.h2,{id:"creating-your-workflow",children:"Creating your workflow"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Create ",(0,t.jsx)(s.code,{children:".github/workflows/deploy-site.yml"})," in your repository."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Add checkout step to get your repository files."}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"If your site needs building, add build steps:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Add build environment setup (Node.js, and so on)."}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Add build commands."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Set your ",(0,t.jsx)(s.code,{children:"DIST"})," path:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["For sites requiring build: Point to your build output directory (for example, ",(0,t.jsx)(s.code,{children:"dist/"}),", ",(0,t.jsx)(s.code,{children:"build/"}),")."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"For static sites: Point directly to your static files directory."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Add the Walrus Site action with your configured secrets and variables."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["The key is ensuring your ",(0,t.jsx)(s.code,{children:"DIST"})," path points to a directory containing the final, deployable static files that should be published to Walrus."]}),"\n",(0,t.jsx)(s.h2,{id:"example-workflows",children:"Example workflows"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://github.com/MystenLabs/walrus-sites/blob/main/.github/workflows/deploy-snake.yml",children:"deploy-snake.yml"})," - Simple static site deployment"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"https://github.com/MystenLabs/walrus-sites/blob/main/.github/workflows/deploy-vite-react-ts.yml",children:"deploy-vite-react-ts.yml"})," - React application with build step"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["For more information about creating and configuring GitHub workflows, check the ",(0,t.jsx)(s.a,{href:"https://docs.github.com/en/actions/writing-workflows",children:"official GitHub Actions documentation"}),"."]})]})}function h(e={}){let{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}function u(e,s){throw Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);