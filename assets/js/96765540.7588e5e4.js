"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[6935],{5756(e,t,s){s.d(t,{R:()=>i,x:()=>r});var a=s(9471);let o={},n=a.createContext(o);function i(e){let t=a.useContext(n);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),a.createElement(n.Provider,{value:t},e.children)}},9081(e,t,s){s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>l});let a=JSON.parse('{"id":"design/operations-sui","title":"Operations on Sui","description":"Walrus operations on Sui blockchain including storage resource lifecycle, smart contracts, and governance mechanisms.","source":"@site/../content/design/operations-sui.mdx","sourceDirName":"design","slug":"/design/operations-sui","permalink":"/docs/design/operations-sui","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/design/operations-sui.mdx","tags":[],"version":"current","frontMatter":{"title":"Operations on Sui","description":"Walrus operations on Sui blockchain including storage resource lifecycle, smart contracts, and governance mechanisms.","keywords":["walrus","sui blockchain","smart contracts","storage resources","governance","storage fund","availability certificate","metadata"]}}');var o=s(2615),n=s(5756);let i={title:"Operations on Sui",description:"Walrus operations on Sui blockchain including storage resource lifecycle, smart contracts, and governance mechanisms.",keywords:["walrus","sui blockchain","smart contracts","storage resources","governance","storage fund","availability certificate","metadata"]},r,c={},l=[{value:"Sui smart contracts",id:"sui-smart-contracts",level:2},{value:"Walrus system object",id:"walrus-system-object",level:3},{value:"Storage fund",id:"storage-fund",level:3},{value:"Storage resource lifecycle",id:"storage-resource-lifecycle",level:2},{value:"Acquiring storage",id:"acquiring-storage",level:3},{value:"Assigning a blob ID",id:"assigning-a-blob-id",level:3},{value:"Certifying availability",id:"certifying-availability",level:3},{value:"Extending storage",id:"extending-storage",level:3},{value:"Handling inconsistent blobs",id:"handling-inconsistent-blobs",level:3},{value:"Interacting with Walrus",id:"interacting-with-walrus",level:3}];function d(e){let t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",strong:"strong",...(0,n.R)(),...e.components},{Term:s}=t;return s||function(e,t){throw Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Term",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.p,{children:["Walrus uses ",(0,o.jsx)(t.a,{href:"https://docs.sui.io/guides/developer/sui-101/move-package-management",children:"Sui smart contracts"})," to coordinate storage resource lifecycle operations and payments. Smart contracts also facilitate governance to determine the ",(0,o.jsx)(s,{lookup:"Storage node",children:"storage nodes"})," holding each storage ",(0,o.jsx)(s,{lookup:"Shard",children:"shard"}),". This page outlines these operations and refers to them as part of the read and write paths."]}),"\n",(0,o.jsxs)(t.p,{children:["Metadata is the only ",(0,o.jsx)(s,{lookup:"Blob",children:"blob"})," element ever exposed to Sui or ",(0,o.jsx)(t.a,{href:"https://docs.sui.io/guides/operator/validator-index",children:"its validators"}),", as the content of ","blobs"," is always stored off-chain on Walrus ","storage nodes"," and caches. The ","storage nodes"," or caches do not have to overlap with any Sui infrastructure components (such as validators), and the ",(0,o.jsx)(t.a,{href:"/blog/04_testnet_update#epochs",children:"storage epochs"})," can have different lengths and timing than ",(0,o.jsx)(t.a,{href:"https://docs.sui.io/concepts/sui-architecture/epochs",children:"Sui epochs"}),"."]}),"\n",(0,o.jsx)(t.h2,{id:"sui-smart-contracts",children:"Sui smart contracts"}),"\n",(0,o.jsx)(t.p,{children:"A number of Sui smart contracts hold the metadata of the Walrus system and all its entities."}),"\n",(0,o.jsx)(t.h3,{id:"walrus-system-object",children:"Walrus system object"}),"\n",(0,o.jsxs)(t.p,{children:["Each Walrus ",(0,o.jsx)(s,{lookup:"Storage epoch",children:"storage epoch"})," is represented by the ",(0,o.jsx)(t.a,{href:"https://walruscan.com/testnet/operators",children:"Walrus system object"})," that contains a ",(0,o.jsx)(s,{lookup:"Storage committee",children:"storage committee"})," and various metadata or ","storage nodes",", including the mapping between shards and ","storage nodes",", available space, and current costs. The system object also holds the total available space on Walrus, and the price per unit of storage."]}),"\n",(0,o.jsxs)(t.p,{children:["These values are determined by 2/3 agreement between ","storage nodes"," for each ","storage epoch",". You can pay to purchase storage space for specified durations. These space resources can be split, merged, and transferred. Later, you can use them to place a ",(0,o.jsx)(s,{lookup:"Blob ID",children:"blob ID"})," into Walrus."]}),"\n",(0,o.jsx)(t.h3,{id:"storage-fund",children:"Storage fund"}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.strong,{children:"storage fund"})," holds funds for storing ","blobs"," over one or multiple storage epochs. You pay into the storage fund when purchasing storage space from the system object, and payments are separated and allocated across multiple storage epochs."]}),"\n",(0,o.jsxs)(t.p,{children:["At the end of each epoch, funds are distributed to ","storage nodes"," based on performance. ","Storage nodes"," perform light audits of each other and suggest which nodes should be paid based on audit results."]}),"\n",(0,o.jsx)(t.h2,{id:"storage-resource-lifecycle",children:"Storage resource lifecycle"}),"\n",(0,o.jsx)(t.p,{children:"Storage resources on Walrus have a defined lifecycle on Sui, from acquisition through certification to expiration."}),"\n",(0,o.jsx)(t.h3,{id:"acquiring-storage",children:"Acquiring storage"}),"\n",(0,o.jsx)(t.p,{children:"Purchase storage space from the system object by paying into the storage fund for a specified duration (one or more storage epochs). You can split, merge, or transfer storage, and the maximum number of storage epochs that you can purchase is approximately 2 years in advance."}),"\n",(0,o.jsxs)(t.h3,{id:"assigning-a-blob-id",children:["Assigning a ","blob ID"]}),"\n",(0,o.jsxs)(t.p,{children:["Once you acquire some storage, you can assign a ","blob ID"," to indicate intent to store. This emits a Move ",(0,o.jsx)(t.strong,{children:"resource event"}),", signaling to ","storage nodes"," that they should expect and authorize off-chain storage operations."]}),"\n",(0,o.jsx)(t.h3,{id:"certifying-availability",children:"Certifying availability"}),"\n",(0,o.jsxs)(t.p,{children:["After uploading ","blob"," data off-chain, availability is certified on Sui:"]}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["Upload ","blob"," slivers to ","storage nodes"," off-chain."]}),"\n",(0,o.jsxs)(t.li,{children:["Storage nodes"," provide an ",(0,o.jsx)(t.strong,{children:"availability certificate"}),"."]}),"\n",(0,o.jsx)(t.li,{children:"Upload the certificate on-chain."}),"\n",(0,o.jsx)(t.li,{children:"System checks certificate against the current Walrus committee."}),"\n",(0,o.jsxs)(t.li,{children:["If valid, system emits an ",(0,o.jsx)(t.strong,{children:"availability event"})," for the ","blob ID","."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["The availability event marks the ",(0,o.jsx)(t.a,{href:"/docs/design/properties",children:"point of availability"})," for the ","blob",", after which Walrus guarantees its availability for the specified duration."]}),"\n",(0,o.jsx)(t.h3,{id:"extending-storage",children:"Extending storage"}),"\n",(0,o.jsxs)(t.p,{children:["At a later time, you can extend a certified ","blob","'s storage by adding a storage object to it with a longer ",(0,o.jsx)(s,{lookup:"Expiry",children:"expiry"})," period. Smart contracts can use this mechanism to extend the availability of ","blobs"," stored in perpetuity, as long as funds exist to continue providing storage."]}),"\n",(0,o.jsxs)(t.h3,{id:"handling-inconsistent-blobs",children:["Handling inconsistent ","blobs"]}),"\n",(0,o.jsxs)(t.p,{children:["In case a ","blob ID"," is not correctly encoded, an ",(0,o.jsx)(t.a,{href:"/docs/design/encoding",children:(0,o.jsxs)(t.strong,{children:[(0,o.jsx)(s,{lookup:"Inconsistency proof",children:"inconsistency proof"})," certificate"]})})," can be uploaded on-chain at a later time. This action emits an ",(0,o.jsxs)(t.strong,{children:["inconsistent ","blob"," event"]})," signaling that the ","blob ID"," read results always return ",(0,o.jsx)(t.code,{children:"None"}),". This indicates that ","storage nodes"," can delete its slivers, except for an indicator to return ",(0,o.jsx)(t.code,{children:"None"}),"."]}),"\n",(0,o.jsx)(t.h3,{id:"interacting-with-walrus",children:"Interacting with Walrus"}),"\n",(0,o.jsxs)(t.p,{children:["When writing to Walrus, you need to perform Sui transactions to acquire storage and certify ","blobs",". When creating or consuming proofs for attestations of ","blob"," availability, you read the chain only to prove or verify emission of events. Nodes read the blockchain to get committee metadata only once per epoch, and then request slivers directly from ","storage nodes"," by ","blob ID"," to perform reads on Walrus resources."]})]})}function h(e={}){let{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);