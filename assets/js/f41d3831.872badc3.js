"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[143],{5574(e,s,t){t.d(s,{A:()=>i});let i=t.p+"assets/images/walrus-sites-portal-diagram-with-quilts-492ccd1dcda79e37e64cf4dca26f05b5.svg"},5756(e,s,t){t.d(s,{R:()=>o,x:()=>a});var i=t(9471);let r={},n=i.createContext(r);function o(e){let s=i.useContext(n);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(n.Provider,{value:s},e.children)}},7362(e,s,t){t.r(s),t.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>o,metadata:()=>i,toc:()=>d});let i=JSON.parse('{"id":"sites/introduction/technical-overview","title":"Technical Overview","description":"Technical deep dive into Walrus Sites architecture, Sui objects, resource storage, and site rendering pathways.","source":"@site/../content/sites/introduction/technical-overview.mdx","sourceDirName":"sites/introduction","slug":"/sites/introduction/technical-overview","permalink":"/docs/sites/introduction/technical-overview","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/sites/introduction/technical-overview.mdx","tags":[],"version":"current","frontMatter":{"title":"Technical Overview","description":"Technical deep dive into Walrus Sites architecture, Sui objects, resource storage, and site rendering pathways.","keywords":["walrus sites","technical overview","sui objects","dynamic fields","site rendering","portal architecture","site builder","domain isolation"]},"sidebar":"sitesSidebar","previous":{"title":"Introduction to Walrus Sites","permalink":"/docs/sites/introduction/components"},"next":{"title":"Installing the Site Builder","permalink":"/docs/sites/getting-started/installing-the-site-builder"}}');var r=t(2615),n=t(5756);let o={title:"Technical Overview",description:"Technical deep dive into Walrus Sites architecture, Sui objects, resource storage, and site rendering pathways.",keywords:["walrus sites","technical overview","sui objects","dynamic fields","site rendering","portal architecture","site builder","domain isolation"]},a,l={},d=[{value:"The site rendering path",id:"the-site-rendering-path",level:3},{value:"Browsing and domain isolation",id:"browsing-and-domain-isolation",level:3},{value:"Walrus Site portals",id:"walrus-site-portals",level:2},{value:"The end-to-end resolution of a Walrus Site",id:"the-end-to-end-resolution-of-a-walrus-site",level:3},{value:"<code>site-builder</code>",id:"site-builder",level:2}];function h(e){let s={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components},{Term:i}=s;return i||function(e,s){throw Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Term",!0),(0,r.jsxs)(r.Fragment,{children:["\n",(0,r.jsxs)(s.p,{children:["Walrus Sites are enabled by Sui and Walrus. The resources of a Walrus Site (",(0,r.jsx)(s.code,{children:"html"}),", ",(0,r.jsx)(s.code,{children:"css"}),", ",(0,r.jsx)(s.code,{children:"js"}),", images, and so on) are stored on Walrus, while the main entry point to it is an object stored on Sui that contains the metadata for the site and points to the Walrus ",(0,r.jsx)(i,{lookup:"Blob",children:"blob"})," IDs."]}),"\n",(0,r.jsxs)(s.p,{children:["A Walrus ",(0,r.jsx)(s.code,{children:"Site"})," is represented on Sui as an object:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-move",children:"struct Site has key, store {\n    id: UID,\n    name: String,\n}\n"})}),"\n",(0,r.jsxs)(s.p,{children:["The resources associated with this site are then added to this object as ",(0,r.jsx)(s.a,{href:"https://docs.sui.io/concepts/versioning#dynamic-fields",children:"dynamic fields"})," of type ",(0,r.jsx)(s.code,{children:"Resource"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-move",children:"struct Resource has store, drop {\n    path: String,\n    // The walrus blob id containing the bytes for this resource\n    blob_id: u256,\n    \u22EE\n}\n"})}),"\n",(0,r.jsx)(s.p,{children:"Importantly, each resource contains:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"path"})," of the resource, for example ",(0,r.jsx)(s.code,{children:"/index.html"}),". All the paths are always represented as starting from root ",(0,r.jsx)(s.code,{children:"/"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"blob_id"}),", which is the Walrus ",(0,r.jsx)(i,{lookup:"Blob ID",children:"blob ID"})," where the resource can be found."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Additional fields."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["These ",(0,r.jsx)(s.code,{children:"Resource"})," dynamic fields are keyed with a struct of type ",(0,r.jsx)(s.code,{children:"ResourcePath"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-move",children:"struct ResourcePath has copy, store, drop {\n    path: String,\n}\n"})}),"\n",(0,r.jsxs)(s.p,{children:["This struct holds the string of the path (",(0,r.jsx)(s.code,{children:"/index.html"}),") and ensures that there are no namespace collisions with other dynamic fields possibly added by other packages."]}),"\n",(0,r.jsxs)(s.p,{children:["To see this in action, look at ",(0,r.jsx)(s.a,{href:"https://suiscan.xyz/testnet/object/0xd20b90149409ba5d005d4a2cd981db9494bc3cdb2f04c47ca1af98dd8f71610a",children:"a Walrus Site in the explorer"}),", and check its dynamic fields."]}),"\n",(0,r.jsx)(s.h3,{id:"the-site-rendering-path",children:"The site rendering path"}),"\n",(0,r.jsxs)(s.p,{children:["Given the Sui object ID of a Walrus Site, it is easy to look up the resources that compose it by looking at the dynamic fields, and then fetch these resources from Walrus using the ","blob ID"," contained in the ",(0,r.jsx)(s.code,{children:"Resource"})," struct."]}),"\n",(0,r.jsxs)(s.p,{children:["A few approaches to perform these lookups on the ",(0,r.jsx)(i,{lookup:"Client",children:"client"})," are:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Having a server that accepts requests for a Sui object ID and possibly a path, then performs this resolution on behalf of the ","client",", serving back the resource as a standard HTML response."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Using a custom application on the ","client"," that has both a web browser and knowledge of how Walrus Sites work, and can locally perform this resolution."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"A hybrid approach based on service workers, where a service worker that is able to perform the resolution is installed in the browser from a portal."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Currently, the server-side and the service-worker based approaches are provided."}),"\n",(0,r.jsx)(s.p,{children:"All of these approaches are viable and have trade-offs. The first has been used for similar applications in IPFS gateways, for example."}),"\n",(0,r.jsx)(s.h3,{id:"browsing-and-domain-isolation",children:"Browsing and domain isolation"}),"\n",(0,r.jsxs)(s.p,{children:["You must ensure that when browsing multiple sites through a portal, for example the one hosted at ",(0,r.jsx)(s.a,{href:"https://wal.app",children:"https://wal.app"}),", these sites are isolated. Isolation is necessary for security and to ensure that the wallet connection in the browser works as expected."]}),"\n",(0,r.jsxs)(s.p,{children:["To do so, each Walrus Site is given a specific subdomain of the portal's domain. For example, the Flatland dApp is hosted at ",(0,r.jsx)(s.a,{href:"https://flatland.wal.app",children:"https://flatland.wal.app"}),", where the subdomain ",(0,r.jsx)(s.code,{children:"flatland"})," is uniquely associated to the object ID of the Walrus Site through SuiNS."]}),"\n",(0,r.jsx)(s.p,{children:"Walrus Sites also work without SuiNS. When a site is accessed through a self-hosted portal, or through a portal that supports Base36 domain resolution, a site can be browsed by using as subdomain the Base36 encoding of the Sui object ID of the site."}),"\n",(0,r.jsx)(s.admonition,{type:"danger",children:(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"wal.app"})," portal does not support Base36 domain resolution. ",(0,r.jsx)(s.a,{href:"https://58gr4pinoayuijgdixud23441t55jd94ugep68fsm72b8mwmq2.wal.app",children:"https://58gr4pinoayuijgdixud23441t55jd94ugep68fsm72b8mwmq2.wal.app"})," is not a valid URL. If you want to access such a site, you should either use another portal or ",(0,r.jsx)(s.a,{href:"/docs/sites/portals/deploy-locally#running-a-local-portal",children:"host your own"}),"."]})}),"\n",(0,r.jsx)(s.p,{children:"Base36 was chosen for 2 reasons, forced by the subdomain standards:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"A subdomain can have at most 63 characters, while a hex-encoded Sui object ID requires 64."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"A subdomain is case insensitive, ruling out other popular encodings, for example, Base64 or Base58."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"walrus-site-portals",children:"Walrus Site portals"}),"\n",(0,r.jsx)(s.p,{children:"There are 2 types of portals provided to browse Walrus Sites:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["The server-side portal, which is a server that resolves a Walrus Site, returning it to the browser. The server-side portal is hosted at ",(0,r.jsx)(s.a,{href:"https://wal.app",children:"https://wal.app"}),". This portal only supports sites that are associated with a SuiNS name."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"The service-worker portal, which is a service worker that is installed in the browser and resolves a Walrus Site. The service-worker portal is no longer hosted at a specific domain, but the code is still maintained so that it can be used by anyone."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["The following section shows in greater detail how a Walrus Site is rendered in a ","client","'s browser using a generic portal. Depending on the different type of portal, some details might differ, but the general picture remains unchanged."]}),"\n",(0,r.jsx)(s.h3,{id:"the-end-to-end-resolution-of-a-walrus-site",children:"The end-to-end resolution of a Walrus Site"}),"\n",(0,r.jsx)(s.p,{children:"The steps below all reference the following figure:"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Walrus Site resolution",src:t(5574).A+"",width:"1480",height:"1288"})}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Site publishing"})," (step 0 in the diagram): The site developer publishes the Walrus Site using the ",(0,r.jsx)(s.a,{href:"#the-site-builder",children:(0,r.jsx)(s.code,{children:"site-builder"})}),", or making use of a ",(0,r.jsx)(i,{lookup:"Publisher",children:"publisher"}),". Assume the developer uses the SuiNS name ",(0,r.jsx)(s.code,{children:"dapp.sui"})," to point to the object ID of the created Walrus Site."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Browsing starts"})," (step 1 in the diagram): A ","client"," browses ",(0,r.jsx)(s.code,{children:"dapp.wal.app/index.html"})," in their browser."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Site resolution"})," (steps 2-6 in the diagram): The portal interprets its origin ",(0,r.jsx)(s.code,{children:"dapp.wal.app"}),", and makes a SuiNS resolution for ",(0,r.jsx)(s.code,{children:"dapp.sui"}),", obtaining the related object ID. Using the object ID, it then fetches the dynamic fields of the object, also checking ",(0,r.jsx)(s.a,{href:"/docs/sites/portals/deploy-locally",children:"redirects"}),". From the dynamic fields, it selects the one for ",(0,r.jsx)(s.code,{children:"/index.html"}),", and extracts its Walrus ","blob ID"," and headers (see the ",(0,r.jsx)(s.a,{href:"/docs/sites/configuration/setting-up-routing-rules",children:"advanced section on headers"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsxs)(s.strong,{children:["Blob"," fetch"]})," (steps 7-11 in the diagram): Given the ","blob ID",", the portal queries a Walrus ",(0,r.jsx)(i,{lookup:"Aggregator",children:"aggregator"})," for the ","blob"," data."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Returning the response"})," (steps 12-13 in the diagram): Now that the portal has the bytes for ",(0,r.jsx)(s.code,{children:"/index.html"}),", and its headers, it can craft a response that is then rendered by the browser."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["These steps are executed for all resources the browser might query thereafter, for example, if ",(0,r.jsx)(s.code,{children:"/index.html"})," points to ",(0,r.jsx)(s.code,{children:"assets/cat.png"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"site-builder",children:(0,r.jsx)(s.code,{children:"site-builder"})}),"\n",(0,r.jsxs)(s.p,{children:["To facilitate the creation of Walrus Sites, the ",(0,r.jsx)(s.code,{children:"site-builder"})," tool is provided. The ",(0,r.jsx)(s.code,{children:"site-builder"})," takes care of creating Walrus Sites object on Sui, with the correct structure, and stores the site resources to Walrus. Refer to the ",(0,r.jsx)(s.a,{href:"/docs/sites",children:"tutorial"})," for setup and usage instructions."]})]})}function c(e={}){let{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);