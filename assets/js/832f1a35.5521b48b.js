"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[4494],{2184(e,n,r){r.r(n),r.d(n,{assets:()=>h,contentTitle:()=>d,default:()=>x,frontMatter:()=>c,metadata:()=>s,toc:()=>p});let s=JSON.parse('{"id":"sites/portals/deploy-locally","title":"Walrus Sites Portal","description":"Guide to Walrus Sites portals including server-side, service-worker portals, local deployment, and configuration options.","source":"@site/../content/sites/portals/deploy-locally.mdx","sourceDirName":"sites/portals","slug":"/sites/portals/deploy-locally","permalink":"/docs/sites/portals/deploy-locally","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/sites/portals/deploy-locally.mdx","tags":[],"version":"current","frontMatter":{"title":"Walrus Sites Portal","description":"Guide to Walrus Sites portals including server-side, service-worker portals, local deployment, and configuration options.","keywords":["walrus sites","portal","server-side portal","service-worker","local deployment","configuration","hosting","docker"]},"sidebar":"sitesSidebar","previous":{"title":"Site Builder Configuration","permalink":"/docs/sites/getting-started/configuration-file-reference"},"next":{"title":"Walrus Sites Portal","permalink":"/docs/sites/portals/deploy-locally"}}');var l=r(2615),o=r(5756),t=r(9471),i=r(2774);let a=()=>{let[e,n]=(0,t.useState)([]),[r,s]=(0,t.useState)(!0),[o,a]=(0,t.useState)(null),c=(0,i.Ay)("/portals.json");return((0,t.useEffect)(()=>{(async()=>{try{let e=await fetch(c);if(!e.ok)throw Error("Failed to fetch portals data");let r=await e.json(),l=Object.entries(r.portals).map(([e,n])=>({url:e,operator:n.operator}));n(l),s(!1)}catch(e){a(e instanceof Error?e.message:"Unknown error occurred"),s(!1)}})()},[]),r)?(0,l.jsx)("div",{className:"loading_wgIq",children:"Loading portals..."}):o?(0,l.jsxs)("div",{className:"error_co6O",children:["Error: ",o]}):0===e.length?(0,l.jsx)("div",{className:"empty_tnEu",children:"No portals available"}):(0,l.jsxs)("div",{className:"container_cKnO",children:[(0,l.jsx)("h3",{className:"title_L86B",children:"Available Portals"}),(0,l.jsx)("ul",{className:"portalsList_UKoR",children:e.map(e=>(0,l.jsx)("li",{className:"portalItem_WGIT",children:(0,l.jsxs)("div",{className:"portalContent_o5yI",children:[(0,l.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"portalUrl_dKdA",children:e.url}),(0,l.jsxs)("span",{className:"portalOperator_yrBG",children:["Operated by: ",e.operator]})]})},e.url))})]})},c={title:"Walrus Sites Portal",description:"Guide to Walrus Sites portals including server-side, service-worker portals, local deployment, and configuration options.",keywords:["walrus sites","portal","server-side portal","service-worker","local deployment","configuration","hosting","docker"]},d,h={},p=[{value:"Known portals",id:"known-portals",level:2},{value:"Running a local portal",id:"running-a-local-portal",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Environment variables",id:"environment-variables",level:4},{value:"Mainnet server portal environment variables",id:"mainnet-server-portal-environment-variables",level:5},{value:"Testnet server portal environment variables",id:"testnet-server-portal-environment-variables",level:5},{value:"Mainnet service-worker portal environment variables",id:"mainnet-service-worker-portal-environment-variables",level:5},{value:"Testnet service-worker portal environment variables",id:"testnet-service-worker-portal-environment-variables",level:5},{value:"Constants",id:"constants",level:4},{value:"Deploying the portal",id:"deploying-the-portal",level:3},{value:"Docker",id:"docker",level:4},{value:"Local development",id:"local-development",level:4}];function u(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components},{Term:r}=n;return r||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Term",!0),(0,l.jsxs)(l.Fragment,{children:["\n",(0,l.jsxs)(n.p,{children:["The term portal is used to indicate any technology that is used to access and browse Walrus Sites. Currently, only a server-side portal is served at ",(0,l.jsx)(n.a,{href:"https://wal.app",children:"https://wal.app"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.a,{href:"https://wal.app",children:"https://wal.app"})," only serves sites deployed on mainnet, linked with SuiNS names. You can run a portal to access Mainnet sites as well. Walrus Foundation does not maintain a portal that serves Testnet Walrus Sites. To access sites deployed on Testnet you can either use a third party Testnet portal, self-host one, or run one locally."]}),"\n",(0,l.jsx)(n.h2,{id:"known-portals",children:"Known portals"}),"\n",(0,l.jsxs)(n.p,{children:["A list of known portals is maintained. Portals can self-identify by opening a PR that adds an entry to ",(0,l.jsx)(n.code,{children:"docs/book/portals/list.json"}),". The stable branch of Walrus Sites is ",(0,l.jsx)(n.code,{children:"mainnet"}),"."]}),"\n","\n",(0,l.jsx)(a,{}),"\n",(0,l.jsxs)(n.p,{children:["The service-worker portal is no longer hosted, but you can still run it locally. Its code is available in the ",(0,l.jsx)(n.code,{children:"walrus-sites"})," repository. For more information, see ",(0,l.jsx)(n.a,{href:"#running-a-local-portal",children:"running a local portal"}),"."]}),"\n",(0,l.jsx)(n.h2,{id:"running-a-local-portal",children:"Running a local portal"}),"\n",(0,l.jsx)(n.p,{children:"Running a portal locally can be useful, for example if you want to browse Walrus Sites without accessing external portals, or for development purposes."}),"\n",(0,l.jsxs)(n.p,{children:["Start by cloning the ",(0,l.jsx)(n.code,{children:"walrus-sites"})," repository:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ git clone https://github.com/MystenLabs/walrus-sites.git\n$ cd walrus-sites\n"})}),"\n",(0,l.jsx)(n.p,{children:"Make sure you are on the stable branch:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ git checkout mainnet\n"})}),"\n",(0,l.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsx)(n.p,{children:"Portal configuration is managed through 2 key elements:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Environment variables: Required for basic functionality."}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Constants file: Optional for advanced customization."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"environment-variables",children:"Environment variables"}),"\n",(0,l.jsxs)(n.p,{children:["The environment variables are set in the ",(0,l.jsx)(n.code,{children:".env.local"})," file at the root of each portal directory. To just run a simple instance of a portal, you can use the environment variables specified in the ",(0,l.jsx)(n.code,{children:".env.<network>.example"})," file:"]}),"\n",(0,l.jsx)(n.h5,{id:"mainnet-server-portal-environment-variables",children:"Mainnet server portal environment variables"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ cp ./portal/server/.env.mainnet.example ./portal/server/.env.local\n"})}),"\n",(0,l.jsx)(n.h5,{id:"testnet-server-portal-environment-variables",children:"Testnet server portal environment variables"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ cp ./portal/server/.env.testnet.example ./portal/server/.env.local\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Likewise, if you want to run the service-worker portal, you can copy the ",(0,l.jsx)(n.code,{children:".env.<network>.example"})," file to ",(0,l.jsx)(n.code,{children:".env.local"})," in the ",(0,l.jsx)(n.code,{children:"portal/worker"})," directory."]}),"\n",(0,l.jsx)(n.h5,{id:"mainnet-service-worker-portal-environment-variables",children:"Mainnet service-worker portal environment variables"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ cp ./portal/worker/.env.mainnet.example ./portal/worker/.env.local\n"})}),"\n",(0,l.jsx)(n.h5,{id:"testnet-service-worker-portal-environment-variables",children:"Testnet service-worker portal environment variables"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ cp ./portal/worker/.env.testnet.example ./portal/worker/.env.local\n"})}),"\n",(0,l.jsxs)(n.p,{children:["For a more detailed configuration, you can modify the ",(0,l.jsx)(n.code,{children:".env.local"})," files to suit your needs. As a reference, here are the definitions of the environment variables:"]}),"\n",(0,l.jsxs)(n.p,{children:["The server portal code contains additional functionality that can be enabled or disabled using environment variables. For example, you can enable or disable the blocklist feature by setting the ",(0,l.jsx)(n.code,{children:"ENABLE_BLOCKLIST"})," variable to ",(0,l.jsx)(n.code,{children:"true"})," or ",(0,l.jsx)(n.code,{children:"false"}),". This can be helpful to manage the behavior of the portal. For example, if you host a publicly-accessible portal, you might want to avoid serving sites that are not published by you."]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"AGGREGATOR_URL"}),": The URL to a Walrus ",(0,l.jsx)(r,{lookup:"Aggregator",children:"aggregator"})," that fetches the site resources from Walrus."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"AMPLITUDE_API_KEY"}),": Provide it if you want to enable ",(0,l.jsx)(n.a,{href:"https://amplitude.com/",children:"Amplitude"})," for your server analytics."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"EDGE_CONFIG"}),": If you host your portal on Vercel, you can use the ",(0,l.jsx)(n.a,{href:"https://vercel.com/docs/edge-config",children:"Edge Config"})," to blocklist certain SuiNS subdomains or Base36 object IDs."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"EDGE_CONFIG_ALLOWLIST"}),": Similar to blocklist, but allows certain subdomains to use the premium rpc url list."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ENABLE_ALLOWLIST"}),": Enable the allowlist feature."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ENABLE_BLOCKLIST"}),": Enable the blocklist feature."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ENABLE_SENTRY"}),": Enable Sentry error tracking."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ENABLE_VERCEL_WEB_ANALYTICS"}),": Enable Vercel web analytics."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"LANDING_PAGE_OID_B36"}),": The Base36 object ID of the landing page Walrus Site. That is, the page you get when you visit ",(0,l.jsx)(n.code,{children:"localhost:3000"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"PORTAL_DOMAIN_NAME_LENGTH"}),": If you connect your portal with a domain name, specify the length of the domain name. For example, ",(0,l.jsx)(n.code,{children:"example.com"})," has a length of 11."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"PREMIUM_RPC_URL_LIST"}),": A list of RPC URLs that are used when a site belongs to the allowlist."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"RPC_URL_LIST"}),": A list of RPC URLs that are used when a site does not belong to the allowlist."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"SENTRY_AUTH_TOKEN"}),": If you enable Sentry error tracking, provide your Sentry authentication token."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"SENTRY_DSN"}),": If you enable Sentry error tracking, provide your Sentry DSN."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"SENTRY_TRACES_SAMPLE_RATE"}),": If you enable Sentry error tracking, provide the sample rate for traces."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"SITE_PACKAGE"}),": The Walrus Site package ID. Depending on the network you are using, you have to specify the correct package ID."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"SUINS_CLIENT_NETWORK"}),": The network of the SuiNS ",(0,l.jsx)(r,{lookup:"Client",children:"client"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"B36_DOMAIN_RESOLUTION_SUPPORT"}),": Define if Base36 domain resolution is supported. Otherwise, the site is not served."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"constants",children:"Constants"}),"\n",(0,l.jsxs)(n.p,{children:["You can find the ",(0,l.jsx)(n.code,{children:"constants.ts"})," file in the ",(0,l.jsx)(n.code,{children:"portal/common/lib"})," directory. It holds key configuration parameters for the portal. Typically, you won't need to modify these, but if you do, these are the available parameters:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"MAX_REDIRECT_DEPTH"}),": The number of ",(0,l.jsx)(n.a,{href:"/docs/sites/linking/redirects",children:"redirects"})," the portal follows before stopping."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"SITE_NAMES"}),": Hard coded ",(0,l.jsx)(n.code,{children:"name: objectID"})," mappings, to override the SuiNS names. For development only. Use this at your own risk as it might render some sites with legitimate SuiNS names unusable."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"FALLBACK_PORTAL"}),": This is related only to the service-worker portal. The fallback portal should be a server-side portal that is used in cases where some browsers do not support service-workers."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"deploying-the-portal",children:"Deploying the portal"}),"\n",(0,l.jsx)(n.p,{children:"To run the portal locally you can either use a Docker container or a local development environment."}),"\n",(0,l.jsx)(n.h4,{id:"docker",children:"Docker"}),"\n",(0,l.jsxs)(n.p,{children:["First, make sure you have Docker installed on your system. If it is not installed, follow the instructions on the ",(0,l.jsx)(n.a,{href:"https://docs.docker.com/get-docker/",children:"Docker website"}),"."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ docker --version\n"})}),"\n",(0,l.jsx)(n.p,{children:"Then, build the Docker image with:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ docker build -f portal/docker/server/Dockerfile -t server-portal . --build-arg ENABLE_SENTRY=false --no-cache\n"})}),"\n",(0,l.jsx)(n.p,{children:"Finally, run the Docker container:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ docker run --env-file ./portal/server/.env.local -p 3000:3000 server-portal\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Browse the sites at ",(0,l.jsx)(n.code,{children:"localhost:3000"}),"."]}),"\n",(0,l.jsx)(n.h4,{id:"local-development",children:"Local development"}),"\n",(0,l.jsxs)(n.p,{children:["This requires having the ",(0,l.jsx)(n.a,{href:"https://bun.sh/",children:(0,l.jsx)(n.code,{children:"bun"})})," tool installed:"]}),"\n",(0,l.jsx)(n.p,{children:"Check if bun is installed with:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ bun --version\n"})}),"\n",(0,l.jsx)(n.p,{children:"If not installed, run the following command:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ curl -fsSL https://bun.sh/install | bash\n"})}),"\n",(0,l.jsx)(n.p,{children:"Install the dependencies:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ cd portal\n$ bun install\n"})}),"\n",(0,l.jsx)(n.p,{children:"To run a server-side portal:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ bun run server\n"})}),"\n",(0,l.jsx)(n.p,{children:"To run a service-worker portal:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ bun build:worker\n$ bun run worker\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Find the server side portal served at ",(0,l.jsx)(n.code,{children:"localhost:3000"})," the service worker portal at ",(0,l.jsx)(n.code,{children:"localhost:8080"}),"."]})]})}function x(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(u,{...e})}):u(e)}},5756(e,n,r){r.d(n,{R:()=>t,x:()=>i});var s=r(9471);let l={},o=s.createContext(l);function t(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);